###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.1.53127/W32 for ARM     09/Apr/2013  09:02:55 #
# Copyright 1999-2011 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  L:\git_workspace\YD_PRJ_NEW_20130323_git_\Source\Source_ #
#                    MQX\SD_task.c                                            #
#    Command line =  L:\git_workspace\YD_PRJ_NEW_20130323_git_\Source\Source_ #
#                    MQX\SD_task.c -D _DEBUG=1 -lC                            #
#                    "L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\twrk60n51 #
#                    2\Int Flash Debug\List\" -lA                             #
#                    "L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\twrk60n51 #
#                    2\Int Flash Debug\List\" --diag_suppress                 #
#                    Pa039,Pa082,Pe186 -o "L:\git_workspace\YD_PRJ_NEW_201303 #
#                    23_git_\IAR\twrk60n512\Int Flash Debug\Obj\" --no_cse    #
#                    --no_unroll --no_inline --no_code_motion --no_tbaa       #
#                    --no_clustering --no_scheduling --debug --endian=little  #
#                    --cpu=Cortex-M4 -e --fpu=None --dlib_config "D:\Program  #
#                    Files\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\lib\twr #
#                    k60n512.iar\ -I L:\git_workspace\YD_PRJ_NEW_20130323_git #
#                    _\IAR\..\lib\twrk60n512.iar\bsp\ -I                      #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\lib\twr #
#                    k60n512.iar\psp\ -I L:\git_workspace\YD_PRJ_NEW_20130323 #
#                    _git_\IAR\..\lib\twrk60n512.iar\bsp\Generated_Code\ -I   #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\lib\twr #
#                    k60n512.iar\rtcs\ -I L:\git_workspace\YD_PRJ_NEW_2013032 #
#                    3_git_\IAR\..\lib\twrk60n512.iar\mfs\ -I                 #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\lib\twr #
#                    k60n512.iar\usb\host\ -I L:\git_workspace\YD_PRJ_NEW_201 #
#                    30323_git_\IAR\..\lib\twrk60n512.iar\shell\ -I           #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\lib\twr #
#                    k60n512.iar\usb\ -I L:\git_workspace\YD_PRJ_NEW_20130323 #
#                    _git_\IAR\..\ -I L:\git_workspace\YD_PRJ_NEW_20130323_gi #
#                    t_\IAR\..\Source\Source_MQX\ -I                          #
#                    L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\..\Source\ #
#                     -I "E:\Freescale\Freescale MQX                          #
#                    3.8\shell\source\include\" -Ol --use_c++_inline          #
#    List file    =  L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\twrk60n512 #
#                    \Int Flash Debug\List\SD_task.lst                        #
#    Object file  =  L:\git_workspace\YD_PRJ_NEW_20130323_git_\IAR\twrk60n512 #
#                    \Int Flash Debug\Obj\SD_task.o                           #
#                                                                             #
#                                                                             #
###############################################################################

L:\git_workspace\YD_PRJ_NEW_20130323_git_\Source\Source_MQX\SD_task.c
      1          /**HEADER********************************************************************
      2          *
      3          * Copyright (c) 2008 Freescale Semiconductor;
      4          * All Rights Reserved
      5          *
      6          ***************************************************************************
      7          *
      8          * THIS SOFTWARE IS PROVIDED BY FREESCALE "AS IS" AND ANY EXPRESSED OR
      9          * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
     10          * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
     11          * IN NO EVENT SHALL FREESCALE OR ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
     12          * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
     13          * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
     14          * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
     15          * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
     16          * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
     17          * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
     18          * THE POSSIBILITY OF SUCH DAMAGE.
     19          *
     20          **************************************************************************
     21          *
     22          * $FileName: demo.c$
     23          * $Version : 3.8.31.1$
     24          * $Date    : Mar-26-2012$
     25          *
     26          * Comments: Provide MFS file system on external SD card.
     27          *
     28          *END************************************************************************/
     29          
     30          
     31          #include <mqx.h>
     32          #include <bsp.h>
     33          #include <fio.h>
     34          #include <mfs.h>
     35          
     36          #include <sdcard.h>
     37          #include <sdcard_spi.h>
     38          #include <spi.h>
     39          #include <part_mgr.h>
     40          #include <io_gpio.h>
     41          
     42          #include <lwevent.h>
     43          
     44          
     45          
     46          #if defined BSP_SDCARD_ESDHC_CHANNEL
     47          #if ! BSPCFG_ENABLE_ESDHC
     48          #error This application requires BSPCFG_ENABLE_ESDHC defined non-zero in user_config.h. Please recompile libraries with this option.
     49          #endif
     50          
     51          #elif defined BSP_SDCARD_SDHC_CHANNEL
     52          
     53          #if ! BSPCFG_ENABLE_SDHC
     54          #error This application requires BSPCFG_ENABLE_SDHC defined non-zero in user_config.h. Please recompile libraries with this option.
     55          #endif
     56          
     57          #elif defined (BSP_TWRMCF51CN) || defined (BSP_TWRPXS20) || defined (BSP_TWR_K20D72M)
     58          
     59          #if ! BSPCFG_ENABLE_SPI1
     60          #error This application requires BSPCFG_ENABLE_SPI1 defined non-zero in user_config.h. Please recompile libraries with this option.
     61          #endif
     62          
     63          #else
     64          #if ! BSPCFG_ENABLE_SPI0
     65          #error This application requires BSPCFG_ENABLE_SPI0 defined non-zero in user_config.h. Please recompile libraries with this option.
     66          #endif
     67          
     68          #endif
     69          
     70          #if defined (BSP_SDCARD_SPI_CHANNEL)
     71          #define SDCARD_COM_CHANNEL BSP_SDCARD_SPI_CHANNEL
     72          #elif defined (BSP_SDCARD_ESDHC_CHANNEL)
     73          #define SDCARD_COM_CHANNEL BSP_SDCARD_ESDHC_CHANNEL
     74          #elif defined (BSP_SDCARD_SDHC_CHANNEL)
     75          #define SDCARD_COM_CHANNEL BSP_SDCARD_SDHC_CHANNEL
     76          #else
     77          #error "SDCARD low level communication device not defined!"
     78          #endif
     79          /**************dx 20121210******************************************************/
     80          #define BSP_SDCARD_GPIO_DETECT_INT  0
     81          #define SD_EVENT_DETECT   0x01

   \                                 In section .bss, align 4
     82          LWEVENT_STRUCT SD_Event;
   \                     SD_Event:
   \   00000000                      DS8 36
     83          
     84          
     85          
     86          /*******************************************************************************/
     87          
     88          
     89          
     90          #ifdef BSP_SDCARD_GPIO_CS
     91          
     92          /*FUNCTION*---------------------------------------------------------------
     93          *
     94          * Function Name : set_CS
     95          * Comments  : This function sets chip select signal to enable/disable memory
     96          *
     97          *END*----------------------------------------------------------------------*/
     98          
     99          static void set_CS (uint_32 cs_mask, uint_32 logic_level, pointer user_data)
    100          {
    101              LWGPIO_STRUCT_PTR gpiofd = user_data;
    102          
    103              if (cs_mask & BSP_SDCARD_SPI_CS)
    104              {
    105                  lwgpio_set_value(gpiofd, logic_level ? LWGPIO_VALUE_HIGH : LWGPIO_VALUE_LOW);
    106              }
    107          }
    108          
    109          #endif
    110          #if defined BSP_SDCARD_GPIO_DETECT
    111              #if BSP_SDCARD_GPIO_DETECT_INT
    112              void sd_detect_int__callback()
    113              {
    114                _lwevent_set(&SD_Event,SD_EVENT_DETECT);
    115                
    116              }
    117          
    118              #endif
    119          #endif
    120          
    121          
    122          /*TASK*-----------------------------------------------------------------
    123          *
    124          * Function Name  : sdcard_task
    125          * Returned Value : void
    126          * Comments       :
    127          *
    128          *END------------------------------------------------------------------*/

   \                                 In section .text, align 4, keep-with-next
    129          void sdcard_task(uint_32 temp)
    130          {
   \                     sdcard_task:
   \   00000000   0xE92D 0x4FF0      PUSH     {R4-R11,LR}
   \   00000004   0xB08D             SUB      SP,SP,#+52
    131              boolean      inserted = TRUE, readonly = FALSE, last = FALSE;
   \   00000006   0x2401             MOVS     R4,#+1
   \   00000008   0x2500             MOVS     R5,#+0
   \   0000000A   0xF05F 0x0800      MOVS     R8,#+0
    132              _mqx_int     error_code;
    133              _mqx_uint    param;
    134              MQX_FILE_PTR com_handle, sdcard_handle, filesystem_handle, partman_handle;
    135              char         filesystem_name[] = "a:";// 文件系统 名字
   \   0000000E   0xA800             ADD      R0,SP,#+0
   \   00000010   0x49B2             LDR.N    R1,??sdcard_task_0
   \   00000012   0x680A             LDR      R2,[R1, #0]
   \   00000014   0x6002             STR      R2,[R0, #+0]
    136              char         partman_name[] = "pm:";// 分区管理 名字
   \   00000016   0xA803             ADD      R0,SP,#+12
   \   00000018   0x49B1             LDR.N    R1,??sdcard_task_0+0x4
   \   0000001A   0x680A             LDR      R2,[R1, #0]
   \   0000001C   0x6002             STR      R2,[R0, #+0]
    137          #if defined BSP_SDCARD_GPIO_DETECT
    138              #if ! BSP_SDCARD_GPIO_DETECT_INT
    139              LWGPIO_STRUCT      sd_detect;
    140              #else 
    141              LWGPIO_STRUCT      sd_detect;
    142              /************************dx 20121210**********************************************
    143               */
    144              GPIO_PIN_STRUCT sd_detect_int[] = {
    145                  BSP_SDCARD_GPIO_DETECT | GPIO_PIN_IRQ_FALLING | GPIO_PIN_IRQ_RISING,
    146                  GPIO_LIST_END
    147              };
    148              
    149              MQX_FILE_PTR port_file_sd_detect_int;
    150              /***********************************************************************************/
    151              #endif
    152              
    153              
    154          #endif
    155          #if defined BSP_SDCARD_GPIO_PROTECT
    156              LWGPIO_STRUCT      sd_protect;
    157          #endif
    158          #ifdef BSP_SDCARD_GPIO_CS
    159          
    160              LWGPIO_STRUCT          sd_cs;
    161              SPI_CS_CALLBACK_STRUCT callback;
    162          
    163          #endif
    164              
    165              
    166              /* Open low level communication device */
    167              com_handle = fopen (SDCARD_COM_CHANNEL, NULL);// 打开"esdhc:"模块底层驱动 
   \   0000001E   0x2100             MOVS     R1,#+0
   \   00000020   0x48B0             LDR.N    R0,??sdcard_task_0+0x8
   \   00000022   0x.... 0x....      BL       _io_fopen
   \   00000026   0x4682             MOV      R10,R0
    168          
    169              if (NULL == com_handle)
   \   00000028   0xF1BA 0x0F00      CMP      R10,#+0
   \   0000002C   0xD104             BNE.N    ??sdcard_task_1
    170              {
    171                  printf("Error installing communication handle.\n");
   \   0000002E   0x48AE             LDR.N    R0,??sdcard_task_0+0xC
   \   00000030   0x.... 0x....      BL       _io_printf
    172                  _task_block();
   \   00000034   0x.... 0x....      BL       _task_block
    173              }
    174          
    175          #ifdef BSP_SDCARD_GPIO_CS
    176          
    177              /* Open GPIO file for SPI CS signal emulation */
    178              error_code = lwgpio_init(&sd_cs, BSP_SDCARD_GPIO_CS, LWGPIO_DIR_OUTPUT, LWGPIO_VALUE_NOCHANGE);// 安装简单引脚用于spi片选
    179              if (!error_code)
    180                 {
    181                     printf("Initializing GPIO with associated pins failed.\n");
    182                     _task_block();
    183                 }
    184              lwgpio_set_functionality(&sd_cs,BSP_SDCARD_CS_MUX_GPIO);
    185              lwgpio_set_attribute(&sd_cs, LWGPIO_ATTR_PULL_UP, LWGPIO_AVAL_ENABLE);
    186              /* Set CS callback */
    187              callback.MASK = BSP_SDCARD_SPI_CS;
    188              callback.CALLBACK = set_CS;
    189              callback.USERDATA = &sd_cs;
    190              if (SPI_OK != ioctl (com_handle, IO_IOCTL_SPI_SET_CS_CALLBACK, &callback))
    191              {
    192                  printf ("Setting CS callback failed.\n");
    193                  _task_block();
    194              }
    195          
    196          #endif
    197          
    198          #if defined BSP_SDCARD_GPIO_DETECT
    199              #if ! BSP_SDCARD_GPIO_DETECT_INT
    200              /* Init GPIO pins for other SD card signals */
    201              error_code = lwgpio_init(&sd_detect, BSP_SDCARD_GPIO_DETECT, LWGPIO_DIR_INPUT, LWGPIO_VALUE_NOCHANGE);// 安装简单引脚用于插入检测
   \                     ??sdcard_task_1:
   \   00000038   0x2302             MOVS     R3,#+2
   \   0000003A   0x2200             MOVS     R2,#+0
   \   0000003C   0x49AB             LDR.N    R1,??sdcard_task_0+0x10  ;; 0x8000009c
   \   0000003E   0xA808             ADD      R0,SP,#+32
   \   00000040   0x.... 0x....      BL       lwgpio_init
   \   00000044   0x4683             MOV      R11,R0
    202                 if (!error_code)
   \   00000046   0xF1BB 0x0F00      CMP      R11,#+0
   \   0000004A   0xD104             BNE.N    ??sdcard_task_2
    203                 {
    204                     printf("Initializing GPIO with sdcard detect pin failed.\n");
   \   0000004C   0x48A8             LDR.N    R0,??sdcard_task_0+0x14
   \   0000004E   0x.... 0x....      BL       _io_printf
    205                     _task_block();
   \   00000052   0x.... 0x....      BL       _task_block
    206                 }
    207                 /*Set detect and protect pins as GPIO Function */
    208                 lwgpio_set_functionality(&sd_detect,BSP_SDCARD_DETECT_MUX_GPIO);
   \                     ??sdcard_task_2:
   \   00000056   0x2101             MOVS     R1,#+1
   \   00000058   0xA808             ADD      R0,SP,#+32
   \   0000005A   0x.... 0x....      BL       lwgpio_set_functionality
    209                 lwgpio_set_attribute(&sd_detect, LWGPIO_ATTR_PULL_UP, LWGPIO_AVAL_ENABLE);
   \   0000005E   0x2201             MOVS     R2,#+1
   \   00000060   0x2101             MOVS     R1,#+1
   \   00000062   0xA808             ADD      R0,SP,#+32
   \   00000064   0x.... 0x....      BL       lwgpio_set_attribute
    210             #else 
    211                 /******************dx 20121210***********************************************/
    212                  if (NULL == (port_file_sd_detect_int = fopen("gpio:read", (char_ptr) &sd_detect_int )))
    213                  {
    214                     printf("Opening port_file_sd_detect_int GPIO with associated button1_int failed.\n");
    215                    _task_block();
    216                  }
    217                  ioctl(port_file_sd_detect_int, GPIO_IOCTL_SET_IRQ_FUNCTION, (pointer)sd_detect_int__callback);
    218                   _lwevent_create(&SD_Event,0); // 创建轻量级事件用于检测SD插入
    219                 /****************************************************************************/
    220              
    221             #endif
    222              
    223                
    224          #endif
    225          
    226          #if defined BSP_SDCARD_GPIO_PROTECT
    227              /* Init GPIO pins for other SD card signals */
    228              error_code = lwgpio_init(&sd_protect, BSP_SDCARD_GPIO_PROTECT, LWGPIO_DIR_INPUT, LWGPIO_VALUE_NOCHANGE);// 安装简单引脚用于只读检测
   \   00000068   0x2302             MOVS     R3,#+2
   \   0000006A   0x2200             MOVS     R2,#+0
   \   0000006C   0x49A1             LDR.N    R1,??sdcard_task_0+0x18  ;; 0x8000009b
   \   0000006E   0xA804             ADD      R0,SP,#+16
   \   00000070   0x.... 0x....      BL       lwgpio_init
   \   00000074   0x4683             MOV      R11,R0
    229                 if (!error_code)
   \   00000076   0xF1BB 0x0F00      CMP      R11,#+0
   \   0000007A   0xD104             BNE.N    ??sdcard_task_3
    230                 {
    231                     printf("Initializing GPIO with sdcard protect pin failed.\n");
   \   0000007C   0x489E             LDR.N    R0,??sdcard_task_0+0x1C
   \   0000007E   0x.... 0x....      BL       _io_printf
    232                     _task_block();
   \   00000082   0x.... 0x....      BL       _task_block
    233                 }
    234                 /*Set detect and protect pins as GPIO Function */
    235                 lwgpio_set_functionality(&sd_protect,BSP_SDCARD_PROTECT_MUX_GPIO);
   \                     ??sdcard_task_3:
   \   00000086   0x2101             MOVS     R1,#+1
   \   00000088   0xA804             ADD      R0,SP,#+16
   \   0000008A   0x.... 0x....      BL       lwgpio_set_functionality
    236                 lwgpio_set_attribute(&sd_protect, LWGPIO_ATTR_PULL_UP, LWGPIO_AVAL_ENABLE);
   \   0000008E   0x2201             MOVS     R2,#+1
   \   00000090   0x2101             MOVS     R1,#+1
   \   00000092   0xA804             ADD      R0,SP,#+16
   \   00000094   0x.... 0x....      BL       lwgpio_set_attribute
    237          #endif
    238          
    239              /* Install SD card device */
    240              error_code = _io_sdcard_install("sdcard:", (pointer)&_bsp_sdcard0_init, com_handle);// 安装SD卡驱动，基于"esdhc:"模块
   \   00000098   0x4652             MOV      R2,R10
   \   0000009A   0x4998             LDR.N    R1,??sdcard_task_0+0x20
   \   0000009C   0x4898             LDR.N    R0,??sdcard_task_0+0x24
   \   0000009E   0x.... 0x....      BL       _io_sdcard_install
   \   000000A2   0x4683             MOV      R11,R0
    241              if ( error_code != MQX_OK )
   \   000000A4   0xF1BB 0x0F00      CMP      R11,#+0
   \   000000A8   0xD005             BEQ.N    ??sdcard_task_4
    242              {
    243                  printf("Error installing SD card device (0x%x)\n", error_code);
   \   000000AA   0x4659             MOV      R1,R11
   \   000000AC   0x4895             LDR.N    R0,??sdcard_task_0+0x28
   \   000000AE   0x.... 0x....      BL       _io_printf
    244                  _task_block();
   \   000000B2   0x.... 0x....      BL       _task_block
    245              }
    246                /*使用内部IOCTL命令测试SD卡是否已经插入 dx20121223*/
    247                uint_32  sd_param;
    248               
    249                sd_param = 0;
   \                     ??sdcard_task_4:
   \   000000B6   0x2000             MOVS     R0,#+0
   \   000000B8   0x9002             STR      R0,[SP, #+8]
    250                if (ESDHC_OK != ioctl (com_handle, IO_IOCTL_ESDHC_GET_CARD, &sd_param))
   \   000000BA   0xAA02             ADD      R2,SP,#+8
   \   000000BC   0xF241 0x3103      MOVW     R1,#+4867
   \   000000C0   0x4650             MOV      R0,R10
   \   000000C2   0x.... 0x....      BL       _io_ioctl
   \   000000C6   0x2800             CMP      R0,#+0
   \   000000C8   0xD004             BEQ.N    ??sdcard_task_5
    251                {
    252                   printf("Error get SD card device type.\n");
   \   000000CA   0x488F             LDR.N    R0,??sdcard_task_0+0x2C
   \   000000CC   0x.... 0x....      BL       _io_printf
    253                    _task_block();
   \   000000D0   0x.... 0x....      BL       _task_block
    254                }
    255                if (ESDHC_CARD_NONE != sd_param)
   \                     ??sdcard_task_5:
   \   000000D4   0x9802             LDR      R0,[SP, #+8]
   \   000000D6   0x2800             CMP      R0,#+0
   \   000000D8   0xD005             BEQ.N    ??sdcard_task_6
    256                {
    257                   inserted = TRUE; // 已插入SD卡
   \   000000DA   0x2401             MOVS     R4,#+1
    258                   printf("inserted = 1 -> %d\n",(int)sd_param);
   \   000000DC   0x9902             LDR      R1,[SP, #+8]
   \   000000DE   0x488B             LDR.N    R0,??sdcard_task_0+0x30
   \   000000E0   0x.... 0x....      BL       _io_printf
   \   000000E4   0xE007             B.N      ??sdcard_task_7
    259                }else 
    260                {
    261                   inserted = FALSE; // 无SD卡
   \                     ??sdcard_task_6:
   \   000000E6   0x2400             MOVS     R4,#+0
    262                   printf("inserted = 0 -> %d\n",(int)sd_param);
   \   000000E8   0x9902             LDR      R1,[SP, #+8]
   \   000000EA   0x4889             LDR.N    R0,??sdcard_task_0+0x34
   \   000000EC   0x.... 0x....      BL       _io_printf
   \   000000F0   0xE001             B.N      ??sdcard_task_7
    263                   
    264                }
    265          
    266              for (;;)/////////////////////////////////////////////////////////////////////////////循环
    267              {
    268          
    269          
    270          #if defined BSP_SDCARD_GPIO_PROTECT
    271                  /* Get value of protect pin */
    272                  readonly = lwgpio_get_value(&sd_protect);// 检测磁盘是否只读////////////////////////////////////////
    273          #endif
    274          #ifdef BSP_MPC8308RDB
    275                  /* Set function as SD_CD which indicate that card is present in Present State Register */
    276                  lwgpio_set_functionality(&sd_detect,BSP_SDCARD_DETECT_MUX_SD_CD);
    277                  lwgpio_set_attribute(&sd_detect, LWGPIO_ATTR_PULL_UP, LWGPIO_AVAL_ENABLE);
    278          #endif
    279                  if (last != inserted)
    280                  {
    281                      if (inserted)// 插入磁盘
    282                      {
    283                         // _time_delay (200);// 将活动的任务挂起指定的毫秒数
    284                          /* Open the device which MFS will be installed on */
    285                          sdcard_handle = fopen("sdcard:", 0);// 打开SD卡层驱动
    286                          if ( sdcard_handle == NULL )
    287                          {
    288                              printf("Unable to open SD card device.\n");
    289                              _task_block();
    290                          }
    291          
    292                          /* Set read only flag as needed */
    293                          param = 0;
    294                          if (readonly)
    295                          {
    296                              param = IO_O_RDONLY;
    297                          }
    298                          if (IO_OK != ioctl(sdcard_handle, IO_IOCTL_SET_FLAGS, (char_ptr) &param))
    299                          {
    300                              printf("Setting device read only failed.\n");
    301                              _task_block();
    302                          }
    303          
    304                          /* Install partition manager over SD card driver */
    305                          error_code = _io_part_mgr_install(sdcard_handle, partman_name, 0);// 分区管理
    306                          if (error_code != MFS_NO_ERROR)
    307                          {
    308                              printf("Error installing partition manager: %s\n", MFS_Error_text((uint_32)error_code));
    309                              _task_block();
    310                          }
    311          
    312                          /* Open partition manager */
    313                          partman_handle = fopen(partman_name, NULL);// 打开分区
    314                          if (partman_handle == NULL)
    315                          {
    316                              error_code = ferror(partman_handle);
    317                              printf("Error opening partition manager: %s\n", MFS_Error_text((uint_32)error_code));
    318                              _task_block();
    319                          }
    320          
    321                          /* Validate partition 1 */
    322                          param = 1;
    323                          error_code = _io_ioctl(partman_handle, IO_IOCTL_VAL_PART, &param);// 控制分区
    324                          if (error_code == MQX_OK)
    325                          {
    326          
    327                              /* Install MFS over partition 1 */
    328                              error_code = _io_mfs_install(partman_handle, filesystem_name, param);/////安装文件系统，基于分区
    329                              if (error_code != MFS_NO_ERROR)
    330                              {
    331                                  printf("Error initializing MFS over partition: %s\n", MFS_Error_text((uint_32)error_code));
    332                                  _task_block();
    333                              }
    334          
    335                          } else {
    336          
    337                              /* Install MFS over SD card driver */
    338                              error_code = _io_mfs_install(sdcard_handle, filesystem_name, (_file_size)0);////////安装文件系统，无分区
    339                              if (error_code != MFS_NO_ERROR)
    340                              {
    341                                  printf("Error initializing MFS: %s\n", MFS_Error_text((uint_32)error_code));
    342                                  _task_block();
    343                              }
    344          
    345                          }
    346          
    347                          /* Open file system */
    348                          filesystem_handle = fopen(filesystem_name, NULL);// 打开文件系统
    349                          error_code = ferror (filesystem_handle);
    350                          if ((error_code != MFS_NO_ERROR) && (error_code != MFS_NOT_A_DOS_DISK))
    351                          {
    352                              printf("Error opening filesystem: %s\n", MFS_Error_text((uint_32)error_code));
    353                              _task_block();
    354                          }
    355                          if ( error_code == MFS_NOT_A_DOS_DISK )
    356                          {
    357                              printf("NOT A DOS DISK! You must format to continue.\n");
    358                          }
    359          
    360                          printf ("SD card installed to %s\n", filesystem_name);
    361                          if (readonly)
    362                          {
    363                              printf ("SD card is locked (read only).\n");
    364                          }
    365                      }
    366                      else // 拔出磁盘
    367                      {
    368                          /* Close the filesystem */
    369                          if (MQX_OK != fclose (filesystem_handle))
    370                          {
    371                              printf("Error closing filesystem.\n");
    372                              _task_block();
    373                          }
    374                          filesystem_handle = NULL;
    375          
    376                          /* Uninstall MFS  */
    377                          error_code = _io_dev_uninstall(filesystem_name);
    378                          if (error_code != MFS_NO_ERROR)
    379                          {
    380                              printf("Error uninstalling filesystem.\n");
    381                              _task_block();
    382                          }
    383          
    384                          /* Close partition manager */
    385                          if (MQX_OK != fclose (partman_handle))
    386                          {
    387                              printf("Unable to close partition manager.\n");
    388                              _task_block();
    389                          }
    390                          partman_handle = NULL;
    391          
    392                          /* Uninstall partition manager  */
    393                          error_code = _io_dev_uninstall(partman_name);
    394                          if (error_code != MFS_NO_ERROR)
    395                          {
    396                              printf("Error uninstalling partition manager.\n");
    397                              _task_block();
    398                          }
    399          
    400                          /* Close the SD card device */
    401                          if (MQX_OK != fclose (sdcard_handle))
    402                          {
    403                              printf("Unable to close SD card device.\n");
    404                              _task_block();
    405                          }
    406                          sdcard_handle = NULL;
    407          
    408                          printf ("SD card uninstalled.\n");
    409                          printf ("sd unOK dx.\n");/////////////////////////dx
    410                      }
    411                  }
    412          
    413                  last = inserted;
    414                 // _time_delay (200);// 将活动的任务挂起指定的毫秒数 
    415                  
    416          //        #if defined BSP_SDCARD_GPIO_DETECT
    417          //            #if BSP_SDCARD_GPIO_DETECT_INT
    418          //            /****************dx 20121211************************************************************/
    419          //             _lwevent_wait_ticks(&SD_Event,SD_EVENT_DETECT,FALSE,0);///////////等待事件USB_EVENT
    420          //             _lwevent_clear(&SD_Event,SD_EVENT_DETECT);
    421          //           /****************************************************************************************/    
    422          //            #endif
    423          //        #endif
    424                /*使用SD外部端口测试SD卡是否已经插入*/
    425          #if defined BSP_SDCARD_GPIO_DETECT
    426                  #ifdef BSP_MPC8308RDB
    427                  /* Set function as GPIO to detect sdcard */
    428                  lwgpio_set_functionality(&sd_detect,BSP_SDCARD_DETECT_MUX_GPIO);
    429                  lwgpio_set_attribute(&sd_detect, LWGPIO_ATTR_PULL_UP, LWGPIO_AVAL_ENABLE);
    430                  #endif
    431                  #if ! BSP_SDCARD_GPIO_DETECT_INT
    432                  
    433                  inserted = !lwgpio_get_value(&sd_detect);// 检测磁盘是否插入/////////////////////////////////////////
   \                     ??sdcard_task_8:
   \   000000F2   0x2400             MOVS     R4,#+0
   \                     ??sdcard_task_9:
   \   000000F4   0xB2E4             UXTB     R4,R4            ;; ZeroExt  R4,R4,#+24,#+24
   \                     ??sdcard_task_7:
   \   000000F6   0xA804             ADD      R0,SP,#+16
   \   000000F8   0x.... 0x....      BL       lwgpio_get_value
   \   000000FC   0x0005             MOVS     R5,R0
   \   000000FE   0x45A0             CMP      R8,R4
   \   00000100   0xF000 0x80E2      BEQ.W    ??sdcard_task_10
   \   00000104   0x2C00             CMP      R4,#+0
   \   00000106   0xF000 0x809F      BEQ.W    ??sdcard_task_11
   \   0000010A   0x2100             MOVS     R1,#+0
   \   0000010C   0x487C             LDR.N    R0,??sdcard_task_0+0x24
   \   0000010E   0x.... 0x....      BL       _io_fopen
   \   00000112   0x0006             MOVS     R6,R0
   \   00000114   0x2E00             CMP      R6,#+0
   \   00000116   0xD104             BNE.N    ??sdcard_task_12
   \   00000118   0x487E             LDR.N    R0,??sdcard_task_0+0x38
   \   0000011A   0x.... 0x....      BL       _io_printf
   \   0000011E   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_12:
   \   00000122   0x2000             MOVS     R0,#+0
   \   00000124   0x9001             STR      R0,[SP, #+4]
   \   00000126   0x2D00             CMP      R5,#+0
   \   00000128   0xD001             BEQ.N    ??sdcard_task_13
   \   0000012A   0x2001             MOVS     R0,#+1
   \   0000012C   0x9001             STR      R0,[SP, #+4]
   \                     ??sdcard_task_13:
   \   0000012E   0xAA01             ADD      R2,SP,#+4
   \   00000130   0x2102             MOVS     R1,#+2
   \   00000132   0x0030             MOVS     R0,R6
   \   00000134   0x.... 0x....      BL       _io_ioctl
   \   00000138   0x2800             CMP      R0,#+0
   \   0000013A   0xD004             BEQ.N    ??sdcard_task_14
   \   0000013C   0x4876             LDR.N    R0,??sdcard_task_0+0x3C
   \   0000013E   0x.... 0x....      BL       _io_printf
   \   00000142   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_14:
   \   00000146   0x2200             MOVS     R2,#+0
   \   00000148   0xA903             ADD      R1,SP,#+12
   \   0000014A   0x0030             MOVS     R0,R6
   \   0000014C   0x.... 0x....      BL       _io_part_mgr_install
   \   00000150   0x4683             MOV      R11,R0
   \   00000152   0xF1BB 0x0F00      CMP      R11,#+0
   \   00000156   0xD008             BEQ.N    ??sdcard_task_15
   \   00000158   0x4658             MOV      R0,R11
   \   0000015A   0x.... 0x....      BL       MFS_Error_text
   \   0000015E   0x0001             MOVS     R1,R0
   \   00000160   0x486E             LDR.N    R0,??sdcard_task_0+0x40
   \   00000162   0x.... 0x....      BL       _io_printf
   \   00000166   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_15:
   \   0000016A   0x2100             MOVS     R1,#+0
   \   0000016C   0xA803             ADD      R0,SP,#+12
   \   0000016E   0x.... 0x....      BL       _io_fopen
   \   00000172   0x0007             MOVS     R7,R0
   \   00000174   0x2F00             CMP      R7,#+0
   \   00000176   0xD10C             BNE.N    ??sdcard_task_16
   \   00000178   0x0038             MOVS     R0,R7
   \   0000017A   0x.... 0x....      BL       _io_ferror
   \   0000017E   0x4683             MOV      R11,R0
   \   00000180   0x4658             MOV      R0,R11
   \   00000182   0x.... 0x....      BL       MFS_Error_text
   \   00000186   0x0001             MOVS     R1,R0
   \   00000188   0x4865             LDR.N    R0,??sdcard_task_0+0x44
   \   0000018A   0x.... 0x....      BL       _io_printf
   \   0000018E   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_16:
   \   00000192   0x2001             MOVS     R0,#+1
   \   00000194   0x9001             STR      R0,[SP, #+4]
   \   00000196   0xAA01             ADD      R2,SP,#+4
   \   00000198   0xF240 0x1123      MOVW     R1,#+291
   \   0000019C   0x0038             MOVS     R0,R7
   \   0000019E   0x.... 0x....      BL       _io_ioctl
   \   000001A2   0x4683             MOV      R11,R0
   \   000001A4   0xF1BB 0x0F00      CMP      R11,#+0
   \   000001A8   0xD112             BNE.N    ??sdcard_task_17
   \   000001AA   0x9A01             LDR      R2,[SP, #+4]
   \   000001AC   0xA900             ADD      R1,SP,#+0
   \   000001AE   0x0038             MOVS     R0,R7
   \   000001B0   0x.... 0x....      BL       _io_mfs_install
   \   000001B4   0x4683             MOV      R11,R0
   \   000001B6   0xF1BB 0x0F00      CMP      R11,#+0
   \   000001BA   0xD01B             BEQ.N    ??sdcard_task_18
   \   000001BC   0x4658             MOV      R0,R11
   \   000001BE   0x.... 0x....      BL       MFS_Error_text
   \   000001C2   0x0001             MOVS     R1,R0
   \   000001C4   0x4857             LDR.N    R0,??sdcard_task_0+0x48
   \   000001C6   0x.... 0x....      BL       _io_printf
   \   000001CA   0x.... 0x....      BL       _task_block
   \   000001CE   0xE011             B.N      ??sdcard_task_18
   \                     ??sdcard_task_17:
   \   000001D0   0x2200             MOVS     R2,#+0
   \   000001D2   0xA900             ADD      R1,SP,#+0
   \   000001D4   0x0030             MOVS     R0,R6
   \   000001D6   0x.... 0x....      BL       _io_mfs_install
   \   000001DA   0x4683             MOV      R11,R0
   \   000001DC   0xF1BB 0x0F00      CMP      R11,#+0
   \   000001E0   0xD008             BEQ.N    ??sdcard_task_18
   \   000001E2   0x4658             MOV      R0,R11
   \   000001E4   0x.... 0x....      BL       MFS_Error_text
   \   000001E8   0x0001             MOVS     R1,R0
   \   000001EA   0x484F             LDR.N    R0,??sdcard_task_0+0x4C
   \   000001EC   0x.... 0x....      BL       _io_printf
   \   000001F0   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_18:
   \   000001F4   0x2100             MOVS     R1,#+0
   \   000001F6   0xA800             ADD      R0,SP,#+0
   \   000001F8   0x.... 0x....      BL       _io_fopen
   \   000001FC   0x4681             MOV      R9,R0
   \   000001FE   0x4648             MOV      R0,R9
   \   00000200   0x.... 0x....      BL       _io_ferror
   \   00000204   0x4683             MOV      R11,R0
   \   00000206   0xF1BB 0x0F00      CMP      R11,#+0
   \   0000020A   0xD00C             BEQ.N    ??sdcard_task_19
   \   0000020C   0xF243 0x001A      MOVW     R0,#+12314
   \   00000210   0x4583             CMP      R11,R0
   \   00000212   0xD008             BEQ.N    ??sdcard_task_19
   \   00000214   0x4658             MOV      R0,R11
   \   00000216   0x.... 0x....      BL       MFS_Error_text
   \   0000021A   0x0001             MOVS     R1,R0
   \   0000021C   0x4843             LDR.N    R0,??sdcard_task_0+0x50
   \   0000021E   0x.... 0x....      BL       _io_printf
   \   00000222   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_19:
   \   00000226   0xF243 0x001A      MOVW     R0,#+12314
   \   0000022A   0x4583             CMP      R11,R0
   \   0000022C   0xD102             BNE.N    ??sdcard_task_20
   \   0000022E   0x4840             LDR.N    R0,??sdcard_task_0+0x54
   \   00000230   0x.... 0x....      BL       _io_printf
   \                     ??sdcard_task_20:
   \   00000234   0xA900             ADD      R1,SP,#+0
   \   00000236   0x483F             LDR.N    R0,??sdcard_task_0+0x58
   \   00000238   0x.... 0x....      BL       _io_printf
   \   0000023C   0x2D00             CMP      R5,#+0
   \   0000023E   0xD043             BEQ.N    ??sdcard_task_10
   \   00000240   0x483D             LDR.N    R0,??sdcard_task_0+0x5C
   \   00000242   0x.... 0x....      BL       _io_printf
   \   00000246   0xE03F             B.N      ??sdcard_task_10
   \                     ??sdcard_task_11:
   \   00000248   0x4648             MOV      R0,R9
   \   0000024A   0x.... 0x....      BL       _io_fclose
   \   0000024E   0x2800             CMP      R0,#+0
   \   00000250   0xD004             BEQ.N    ??sdcard_task_21
   \   00000252   0x483A             LDR.N    R0,??sdcard_task_0+0x60
   \   00000254   0x.... 0x....      BL       _io_printf
   \   00000258   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_21:
   \   0000025C   0xF05F 0x0900      MOVS     R9,#+0
   \   00000260   0xA800             ADD      R0,SP,#+0
   \   00000262   0x.... 0x....      BL       _io_dev_uninstall
   \   00000266   0x4683             MOV      R11,R0
   \   00000268   0xF1BB 0x0F00      CMP      R11,#+0
   \   0000026C   0xD004             BEQ.N    ??sdcard_task_22
   \   0000026E   0x4834             LDR.N    R0,??sdcard_task_0+0x64
   \   00000270   0x.... 0x....      BL       _io_printf
   \   00000274   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_22:
   \   00000278   0x0038             MOVS     R0,R7
   \   0000027A   0x.... 0x....      BL       _io_fclose
   \   0000027E   0x2800             CMP      R0,#+0
   \   00000280   0xD004             BEQ.N    ??sdcard_task_23
   \   00000282   0x4830             LDR.N    R0,??sdcard_task_0+0x68
   \   00000284   0x.... 0x....      BL       _io_printf
   \   00000288   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_23:
   \   0000028C   0x2700             MOVS     R7,#+0
   \   0000028E   0xA803             ADD      R0,SP,#+12
   \   00000290   0x.... 0x....      BL       _io_dev_uninstall
   \   00000294   0x4683             MOV      R11,R0
   \   00000296   0xF1BB 0x0F00      CMP      R11,#+0
   \   0000029A   0xD004             BEQ.N    ??sdcard_task_24
   \   0000029C   0x482A             LDR.N    R0,??sdcard_task_0+0x6C
   \   0000029E   0x.... 0x....      BL       _io_printf
   \   000002A2   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_24:
   \   000002A6   0x0030             MOVS     R0,R6
   \   000002A8   0x.... 0x....      BL       _io_fclose
   \   000002AC   0x2800             CMP      R0,#+0
   \   000002AE   0xD004             BEQ.N    ??sdcard_task_25
   \   000002B0   0x4826             LDR.N    R0,??sdcard_task_0+0x70
   \   000002B2   0x.... 0x....      BL       _io_printf
   \   000002B6   0x.... 0x....      BL       _task_block
   \                     ??sdcard_task_25:
   \   000002BA   0x2600             MOVS     R6,#+0
   \   000002BC   0x4824             LDR.N    R0,??sdcard_task_0+0x74
   \   000002BE   0x.... 0x....      BL       _io_printf
   \   000002C2   0x4824             LDR.N    R0,??sdcard_task_0+0x78
   \   000002C4   0x.... 0x....      BL       _io_printf
   \                     ??sdcard_task_10:
   \   000002C8   0x46A0             MOV      R8,R4
   \   000002CA   0xA808             ADD      R0,SP,#+32
   \   000002CC   0x.... 0x....      BL       lwgpio_get_value
   \   000002D0   0x2800             CMP      R0,#+0
   \   000002D2   0xF47F 0xAF0E      BNE.W    ??sdcard_task_8
   \   000002D6   0x2401             MOVS     R4,#+1
   \   000002D8   0xE70C             B.N      ??sdcard_task_9
   \   000002DA   0xBF00             Nop      
   \                     ??sdcard_task_0:
   \   000002DC   0x........         DC32     `?<Constant "a:">`
   \   000002E0   0x........         DC32     `?<Constant "pm:">`
   \   000002E4   0x........         DC32     `?<Constant "esdhc:">`
   \   000002E8   0x........         DC32     `?<Constant "Error installing comm...">`
   \   000002EC   0x8000009C         DC32     0x8000009c
   \   000002F0   0x........         DC32     `?<Constant "Initializing GPIO wit...">`
   \   000002F4   0x8000009B         DC32     0x8000009b
   \   000002F8   0x........         DC32     `?<Constant "Initializing GPIO wit...">_1`
   \   000002FC   0x........         DC32     _bsp_sdcard0_init
   \   00000300   0x........         DC32     `?<Constant "sdcard:">`
   \   00000304   0x........         DC32     `?<Constant "Error installing SD c...">`
   \   00000308   0x........         DC32     `?<Constant "Error get SD card dev...">`
   \   0000030C   0x........         DC32     `?<Constant "inserted = 1 -> %d\\n">`
   \   00000310   0x........         DC32     `?<Constant "inserted = 0 -> %d\\n">`
   \   00000314   0x........         DC32     `?<Constant "Unable to open SD car...">`
   \   00000318   0x........         DC32     `?<Constant "Setting device read o...">`
   \   0000031C   0x........         DC32     `?<Constant "Error installing part...">`
   \   00000320   0x........         DC32     `?<Constant "Error opening partiti...">`
   \   00000324   0x........         DC32     `?<Constant "Error initializing MF...">`
   \   00000328   0x........         DC32     `?<Constant "Error initializing MF...">_1`
   \   0000032C   0x........         DC32     `?<Constant "Error opening filesys...">`
   \   00000330   0x........         DC32     `?<Constant "NOT A DOS DISK! You m...">`
   \   00000334   0x........         DC32     `?<Constant "SD card installed to %s\\n">`
   \   00000338   0x........         DC32     `?<Constant "SD card is locked (re...">`
   \   0000033C   0x........         DC32     `?<Constant "Error closing filesys...">`
   \   00000340   0x........         DC32     `?<Constant "Error uninstalling fi...">`
   \   00000344   0x........         DC32     `?<Constant "Unable to close parti...">`
   \   00000348   0x........         DC32     `?<Constant "Error uninstalling pa...">`
   \   0000034C   0x........         DC32     `?<Constant "Unable to close SD ca...">`
   \   00000350   0x........         DC32     `?<Constant "SD card uninstalled.\\n">`
   \   00000354   0x........         DC32     `?<Constant "sd unOK dx.\\n">`
    434                  #else
    435                  /****************dx 20121211************************************************************/
    436                   _lwevent_wait_ticks(&SD_Event,SD_EVENT_DETECT,FALSE,0);///////////等待事件USB_EVENT
    437                    _lwevent_clear(&SD_Event,SD_EVENT_DETECT);
    438                   ioctl(port_file_sd_detect_int, GPIO_IOCTL_READ, (char_ptr) &sd_detect_int);
    439                   inserted = !( sd_detect_int[0] & GPIO_PIN_STATUS);
    440                 /****************************************************************************************/    
    441                  #endif
    442                      
    443          #endif
    444                  
    445                 
    446              }/////////////////////////////////////////////////////////////////////////////循环
    447          }

   \                                 In section .rodata, align 4
   \                     `?<Constant "a:">`:
   \   00000000   0x61 0x3A          DC8 "a:"
   \              0x00         
   \   00000003   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "pm:">`:
   \   00000000   0x70 0x6D          DC8 "pm:"
   \              0x3A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "esdhc:">`:
   \   00000000   0x65 0x73          DC8 "esdhc:"
   \              0x64 0x68    
   \              0x63 0x3A    
   \              0x00         
   \   00000007   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error installing comm...">`:
   \   00000000   0x45 0x72          DC8 "Error installing communication handle.\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x69    
   \              0x6E 0x67    
   \              0x20 0x63    
   \              0x6F 0x6D    
   \              0x6D 0x75    
   \              0x6E 0x69    
   \              0x63 0x61    
   \              0x74 0x69    
   \              0x6F 0x6E    
   \              0x20 0x68    
   \              0x61 0x6E    
   \              0x64 0x6C    
   \              0x65 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Initializing GPIO wit...">`:
   \   00000000   0x49 0x6E          DC8 "Initializing GPIO with sdcard detect pin failed.\012"
   \              0x69 0x74    
   \              0x69 0x61    
   \              0x6C 0x69    
   \              0x7A 0x69    
   \              0x6E 0x67    
   \              0x20 0x47    
   \              0x50 0x49    
   \              0x4F 0x20    
   \              0x77 0x69    
   \              0x74 0x68    
   \              0x20 0x73    
   \              0x64 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x64 0x65    
   \              0x74 0x65    
   \              0x63 0x74    
   \              0x20 0x70    
   \              0x69 0x6E    
   \              0x20 0x66    
   \              0x61 0x69    
   \              0x6C 0x65    
   \              0x64 0x2E    
   \              0x0A 0x00    
   \   00000032   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Initializing GPIO wit...">_1`:
   \   00000000   0x49 0x6E          DC8 49H, 6EH, 69H, 74H, 69H, 61H, 6CH, 69H
   \              0x69 0x74    
   \              0x69 0x61    
   \              0x6C 0x69    
   \   00000008   0x7A 0x69          DC8 7AH, 69H, 6EH, 67H, 20H, 47H, 50H, 49H
   \              0x6E 0x67    
   \              0x20 0x47    
   \              0x50 0x49    
   \   00000010   0x4F 0x20          DC8 4FH, 20H, 77H, 69H, 74H, 68H, 20H, 73H
   \              0x77 0x69    
   \              0x74 0x68    
   \              0x20 0x73    
   \   00000018   0x64 0x63          DC8 64H, 63H, 61H, 72H, 64H, 20H, 70H, 72H
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x70 0x72    
   \   00000020   0x6F 0x74          DC8 6FH, 74H, 65H, 63H, 74H, 20H, 70H, 69H
   \              0x65 0x63    
   \              0x74 0x20    
   \              0x70 0x69    
   \   00000028   0x6E 0x20          DC8 6EH, 20H, 66H, 61H, 69H, 6CH, 65H, 64H
   \              0x66 0x61    
   \              0x69 0x6C    
   \              0x65 0x64    
   \   00000030   0x2E 0x0A          DC8 2EH, 0AH, 0
   \              0x00         
   \   00000033   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "sdcard:">`:
   \   00000000   0x73 0x64          DC8 "sdcard:"
   \              0x63 0x61    
   \              0x72 0x64    
   \              0x3A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error installing SD c...">`:
   \   00000000   0x45 0x72          DC8 "Error installing SD card device (0x%x)\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x69    
   \              0x6E 0x67    
   \              0x20 0x53    
   \              0x44 0x20    
   \              0x63 0x61    
   \              0x72 0x64    
   \              0x20 0x64    
   \              0x65 0x76    
   \              0x69 0x63    
   \              0x65 0x20    
   \              0x28 0x30    
   \              0x78 0x25    
   \              0x78 0x29    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error get SD card dev...">`:
   \   00000000   0x45 0x72          DC8 "Error get SD card device type.\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x67 0x65    
   \              0x74 0x20    
   \              0x53 0x44    
   \              0x20 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x64 0x65    
   \              0x76 0x69    
   \              0x63 0x65    
   \              0x20 0x74    
   \              0x79 0x70    
   \              0x65 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "inserted = 1 -> %d\\n">`:
   \   00000000   0x69 0x6E          DC8 "inserted = 1 -> %d\012"
   \              0x73 0x65    
   \              0x72 0x74    
   \              0x65 0x64    
   \              0x20 0x3D    
   \              0x20 0x31    
   \              0x20 0x2D    
   \              0x3E 0x20    
   \              0x25 0x64    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "inserted = 0 -> %d\\n">`:
   \   00000000   0x69 0x6E          DC8 "inserted = 0 -> %d\012"
   \              0x73 0x65    
   \              0x72 0x74    
   \              0x65 0x64    
   \              0x20 0x3D    
   \              0x20 0x30    
   \              0x20 0x2D    
   \              0x3E 0x20    
   \              0x25 0x64    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Unable to open SD car...">`:
   \   00000000   0x55 0x6E          DC8 "Unable to open SD card device.\012"
   \              0x61 0x62    
   \              0x6C 0x65    
   \              0x20 0x74    
   \              0x6F 0x20    
   \              0x6F 0x70    
   \              0x65 0x6E    
   \              0x20 0x53    
   \              0x44 0x20    
   \              0x63 0x61    
   \              0x72 0x64    
   \              0x20 0x64    
   \              0x65 0x76    
   \              0x69 0x63    
   \              0x65 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Setting device read o...">`:
   \   00000000   0x53 0x65          DC8 "Setting device read only failed.\012"
   \              0x74 0x74    
   \              0x69 0x6E    
   \              0x67 0x20    
   \              0x64 0x65    
   \              0x76 0x69    
   \              0x63 0x65    
   \              0x20 0x72    
   \              0x65 0x61    
   \              0x64 0x20    
   \              0x6F 0x6E    
   \              0x6C 0x79    
   \              0x20 0x66    
   \              0x61 0x69    
   \              0x6C 0x65    
   \              0x64 0x2E    
   \              0x0A 0x00    
   \   00000022   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error installing part...">`:
   \   00000000   0x45 0x72          DC8 "Error installing partition manager: %s\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x69    
   \              0x6E 0x67    
   \              0x20 0x70    
   \              0x61 0x72    
   \              0x74 0x69    
   \              0x74 0x69    
   \              0x6F 0x6E    
   \              0x20 0x6D    
   \              0x61 0x6E    
   \              0x61 0x67    
   \              0x65 0x72    
   \              0x3A 0x20    
   \              0x25 0x73    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error opening partiti...">`:
   \   00000000   0x45 0x72          DC8 "Error opening partition manager: %s\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x6F 0x70    
   \              0x65 0x6E    
   \              0x69 0x6E    
   \              0x67 0x20    
   \              0x70 0x61    
   \              0x72 0x74    
   \              0x69 0x74    
   \              0x69 0x6F    
   \              0x6E 0x20    
   \              0x6D 0x61    
   \              0x6E 0x61    
   \              0x67 0x65    
   \              0x72 0x3A    
   \              0x20 0x25    
   \              0x73 0x0A    
   \              0x00         
   \   00000025   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error initializing MF...">`:
   \   00000000   0x45 0x72          DC8 "Error initializing MFS over partition: %s\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x69 0x6E    
   \              0x69 0x74    
   \              0x69 0x61    
   \              0x6C 0x69    
   \              0x7A 0x69    
   \              0x6E 0x67    
   \              0x20 0x4D    
   \              0x46 0x53    
   \              0x20 0x6F    
   \              0x76 0x65    
   \              0x72 0x20    
   \              0x70 0x61    
   \              0x72 0x74    
   \              0x69 0x74    
   \              0x69 0x6F    
   \              0x6E 0x3A    
   \              0x20 0x25    
   \              0x73 0x0A    
   \              0x00         
   \   0000002B   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error initializing MF...">_1`:
   \   00000000   0x45 0x72          DC8 "Error initializing MFS: %s\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x69 0x6E    
   \              0x69 0x74    
   \              0x69 0x61    
   \              0x6C 0x69    
   \              0x7A 0x69    
   \              0x6E 0x67    
   \              0x20 0x4D    
   \              0x46 0x53    
   \              0x3A 0x20    
   \              0x25 0x73    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error opening filesys...">`:
   \   00000000   0x45 0x72          DC8 "Error opening filesystem: %s\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x6F 0x70    
   \              0x65 0x6E    
   \              0x69 0x6E    
   \              0x67 0x20    
   \              0x66 0x69    
   \              0x6C 0x65    
   \              0x73 0x79    
   \              0x73 0x74    
   \              0x65 0x6D    
   \              0x3A 0x20    
   \              0x25 0x73    
   \              0x0A 0x00    
   \   0000001E   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "NOT A DOS DISK! You m...">`:
   \   00000000   0x4E 0x4F          DC8 "NOT A DOS DISK! You must format to continue.\012"
   \              0x54 0x20    
   \              0x41 0x20    
   \              0x44 0x4F    
   \              0x53 0x20    
   \              0x44 0x49    
   \              0x53 0x4B    
   \              0x21 0x20    
   \              0x59 0x6F    
   \              0x75 0x20    
   \              0x6D 0x75    
   \              0x73 0x74    
   \              0x20 0x66    
   \              0x6F 0x72    
   \              0x6D 0x61    
   \              0x74 0x20    
   \              0x74 0x6F    
   \              0x20 0x63    
   \              0x6F 0x6E    
   \              0x74 0x69    
   \              0x6E 0x75    
   \              0x65 0x2E    
   \              0x0A 0x00    
   \   0000002E   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "SD card installed to %s\\n">`:
   \   00000000   0x53 0x44          DC8 "SD card installed to %s\012"
   \              0x20 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x65    
   \              0x64 0x20    
   \              0x74 0x6F    
   \              0x20 0x25    
   \              0x73 0x0A    
   \              0x00         
   \   00000019   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     `?<Constant "SD card is locked (re...">`:
   \   00000000   0x53 0x44          DC8 "SD card is locked (read only).\012"
   \              0x20 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x69 0x73    
   \              0x20 0x6C    
   \              0x6F 0x63    
   \              0x6B 0x65    
   \              0x64 0x20    
   \              0x28 0x72    
   \              0x65 0x61    
   \              0x64 0x20    
   \              0x6F 0x6E    
   \              0x6C 0x79    
   \              0x29 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error closing filesys...">`:
   \   00000000   0x45 0x72          DC8 "Error closing filesystem.\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x63 0x6C    
   \              0x6F 0x73    
   \              0x69 0x6E    
   \              0x67 0x20    
   \              0x66 0x69    
   \              0x6C 0x65    
   \              0x73 0x79    
   \              0x73 0x74    
   \              0x65 0x6D    
   \              0x2E 0x0A    
   \              0x00         
   \   0000001B   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error uninstalling fi...">`:
   \   00000000   0x45 0x72          DC8 "Error uninstalling filesystem.\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x75 0x6E    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x69    
   \              0x6E 0x67    
   \              0x20 0x66    
   \              0x69 0x6C    
   \              0x65 0x73    
   \              0x79 0x73    
   \              0x74 0x65    
   \              0x6D 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Unable to close parti...">`:
   \   00000000   0x55 0x6E          DC8 "Unable to close partition manager.\012"
   \              0x61 0x62    
   \              0x6C 0x65    
   \              0x20 0x74    
   \              0x6F 0x20    
   \              0x63 0x6C    
   \              0x6F 0x73    
   \              0x65 0x20    
   \              0x70 0x61    
   \              0x72 0x74    
   \              0x69 0x74    
   \              0x69 0x6F    
   \              0x6E 0x20    
   \              0x6D 0x61    
   \              0x6E 0x61    
   \              0x67 0x65    
   \              0x72 0x2E    
   \              0x0A 0x00    

   \                                 In section .rodata, align 4
   \                     `?<Constant "Error uninstalling pa...">`:
   \   00000000   0x45 0x72          DC8 "Error uninstalling partition manager.\012"
   \              0x72 0x6F    
   \              0x72 0x20    
   \              0x75 0x6E    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x69    
   \              0x6E 0x67    
   \              0x20 0x70    
   \              0x61 0x72    
   \              0x74 0x69    
   \              0x74 0x69    
   \              0x6F 0x6E    
   \              0x20 0x6D    
   \              0x61 0x6E    
   \              0x61 0x67    
   \              0x65 0x72    
   \              0x2E 0x0A    
   \              0x00         
   \   00000027   0x00               DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "Unable to close SD ca...">`:
   \   00000000   0x55 0x6E          DC8 "Unable to close SD card device.\012"
   \              0x61 0x62    
   \              0x6C 0x65    
   \              0x20 0x74    
   \              0x6F 0x20    
   \              0x63 0x6C    
   \              0x6F 0x73    
   \              0x65 0x20    
   \              0x53 0x44    
   \              0x20 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x64 0x65    
   \              0x76 0x69    
   \              0x63 0x65    
   \              0x2E 0x0A    
   \              0x00         
   \   00000021   0x00 0x00          DC8 0, 0, 0
   \              0x00         

   \                                 In section .rodata, align 4
   \                     `?<Constant "SD card uninstalled.\\n">`:
   \   00000000   0x53 0x44          DC8 "SD card uninstalled.\012"
   \              0x20 0x63    
   \              0x61 0x72    
   \              0x64 0x20    
   \              0x75 0x6E    
   \              0x69 0x6E    
   \              0x73 0x74    
   \              0x61 0x6C    
   \              0x6C 0x65    
   \              0x64 0x2E    
   \              0x0A 0x00    
   \   00000016   0x00 0x00          DC8 0, 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "sd unOK dx.\\n">`:
   \   00000000   0x73 0x64          DC8 "sd unOK dx.\012"
   \              0x20 0x75    
   \              0x6E 0x4F    
   \              0x4B 0x20    
   \              0x64 0x78    
   \              0x2E 0x0A    
   \              0x00         
   \   0000000D   0x00 0x00          DC8 0, 0, 0
   \              0x00         
    448          
    449          /* EOF */

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       88  sdcard_task
             88 -> MFS_Error_text
             88 -> _io_dev_uninstall
             88 -> _io_fclose
             88 -> _io_ferror
             88 -> _io_fopen
             88 -> _io_ioctl
             88 -> _io_mfs_install
             88 -> _io_part_mgr_install
             88 -> _io_printf
             88 -> _io_sdcard_install
             88 -> _task_block
             88 -> lwgpio_get_value
             88 -> lwgpio_init
             88 -> lwgpio_set_attribute
             88 -> lwgpio_set_functionality


   Section sizes:

   Bytes  Function/Label
   -----  --------------
      28  ?<Constant "Error closing filesys...">
      32  ?<Constant "Error get SD card dev...">
      44  ?<Constant "Error initializing MF...">
      28  ?<Constant "Error initializing MF...">_1
      40  ?<Constant "Error installing SD c...">
      40  ?<Constant "Error installing comm...">
      40  ?<Constant "Error installing part...">
      32  ?<Constant "Error opening filesys...">
      40  ?<Constant "Error opening partiti...">
      32  ?<Constant "Error uninstalling fi...">
      40  ?<Constant "Error uninstalling pa...">
      52  ?<Constant "Initializing GPIO wit...">
      52  ?<Constant "Initializing GPIO wit...">_1
      48  ?<Constant "NOT A DOS DISK! You m...">
      28  ?<Constant "SD card installed to %s\n">
      32  ?<Constant "SD card is locked (re...">
      24  ?<Constant "SD card uninstalled.\n">
      36  ?<Constant "Setting device read o...">
      36  ?<Constant "Unable to close SD ca...">
      36  ?<Constant "Unable to close parti...">
      32  ?<Constant "Unable to open SD car...">
       4  ?<Constant "a:">
       8  ?<Constant "esdhc:">
      20  ?<Constant "inserted = 0 -> %d\n">
      20  ?<Constant "inserted = 1 -> %d\n">
       4  ?<Constant "pm:">
      16  ?<Constant "sd unOK dx.\n">
       8  ?<Constant "sdcard:">
      36  SD_Event
     856  sdcard_task

 
  36 bytes in section .bss
 852 bytes in section .rodata
 856 bytes in section .text
 
 856 bytes of CODE  memory
 852 bytes of CONST memory
  36 bytes of DATA  memory

Errors: none
Warnings: none
